@import models.Person
@import config.AppConfig
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import views.html.components.SubNavigation

@this(
  main: Main,
  govukSummaryList: GovukSummaryList,
  subNavigation: SubNavigation
)(
  implicit appConfig: AppConfig
)

@(flatTree: List[(Int, List[Person])], dbId: Int)(implicit request: AuthenticatedRequest[?], messages: Messages)

@id(depth: Int) = @{
  s"generation-$depth"
}


@main(dbId, s"Ascendance of ${flatTree.headOption.flatMap(_._2.headOption).fold("Unknown")(_.details.shortName)}") {

  @for(person <- flatTree.headOption.flatMap(_._2.headOption)) {
    @subNavigation("Ascendants list", dbId, person.details.id)
  }
  @for(gen <- flatTree) {
    @govukSummaryList(
      SummaryList(
        rows = gen._2.map { person =>
          SummaryListRow(
            key = Key(Text(person.details.shortName)),
            value = Value(HtmlContent(person.events.birthAndDeathDate())),
            classes = "govuk-summary-list__row--no-border",
            actions = Some(Actions(
              items = Seq(
                ActionItem(
                  href = controllers.routes.IndividualController.showPerson(dbId, person.details.id).url,
                  content = Text(messages("Details"))
                )
              )
            ))
          )
        },
        card = Some(Card(
          title = Some(CardTitle(content = Text(messages("ascendants.generation", gen._1)))),
          actions = None,
          classes = "govuk-!-margin-4",
          attributes = Map.empty
        )),
        classes = "",
        attributes = Map("id" -> id(gen._1))
      )
    )
  }

}